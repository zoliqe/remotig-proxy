<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Remotig</title>
	<!--<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">-->
	<!--<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">-->
	<!--<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>-->
	<link rel="stylesheet" href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css">
	<script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>

	<style>
		ul {
			list-style-type: none;
		}
		li {
			margin: 1em;
		}
		.offline {
			color: #a01010;
		}
		.online {
			color: #10a010;
		}
		.operated {
			padding-left: 1em;
			color: #d6b70d;
		}
	</style>
</head>
<body>
	<ul>
		<li>
			<div class="mdc-text-field mdc-text-field--outlined mdc-text-field--disabled">
				<h2>Status: <span class="operated" id="who">loading...</span></h2>
			</div>
		</li>
		<li>
			<div class="mdc-text-field mdc-text-field--outlined">
				<input class="mdc-text-field__input" type="text" id="op" placeholder="Call" required minlength="5">
				<!-- <label class="mdc-floating-label" for="op">Call</label> -->
				<div class="mdc-notched-outline"><svg><path class="mdc-notched-outline__path"/></svg></div>
				<div class="mdc-notched-outline__idle"></div>
			</div>
			<div class="mdc-text-field mdc-text-field--outlined">
				<input class="mdc-text-field__input" type="password" id="pin" placeholder="PIN" required minlength="4">
				<!-- <label class="mdc-floating-label" for="pin">PIN</label> -->
				<div class="mdc-notched-outline"><svg><path class="mdc-notched-outline__path"/></svg></div>
				<div class="mdc-notched-outline__idle"></div>
			</div>
		</li>
		<li>
			<button id="tcvr" disabled class="mdc-button mdc-button--raised mdc-ripple-surface">
				Transceiver
			</button>
		</li>
		<li>
			<span id="status"></span>
		</li>
	</ul>

	<script>
		const rig = 'RIG_PLACEHOLDER' // placeholder replaced by server app
		let op = ''
		let pin = ''
		const txtOp = document.querySelector('#op')
		const txtPin = document.querySelector('#pin')
		const btnTcvr = document.querySelector('#tcvr')
		const txtWho = document.querySelector('#who')
		const txtStatus = document.querySelector('#status')
		
		const onChange = () => {
			op = txtOp.value
			pin = txtPin.value
			btnTcvr.disabled = op.length < 5 || pin.length < 4
		}
	
		const onClick = () => {
			console.log('power=on, op:', op)
			location = `/smartceiver/?token=${op.toLowerCase()}-${pin}&rig=${rig}&remoddle=usb`
		}
	
		const fetchWho = async () => {
			const response = await fetch(`/remotig/${rig}/status`)
			let online = false
			if (response.ok) {
				const status = await response.json()
				online = status && status.id
				console.debug('rtt:', status.rtt)
				if (online) txtWho.innerHTML = status.op || '<span class="online">ONLINE&nbsp;&amp;&nbsp;FREE</span>'
			}
			if (!online) txtWho.innerHTML = '<span class="offline">OFFLINE</span>'
		}

		setInterval(fetchWho, 1000)
		mdc.ripple.MDCRipple.attachTo(txtOp)
		mdc.ripple.MDCRipple.attachTo(txtPin)
		txtOp.addEventListener('keyup', onChange)
		txtPin.addEventListener('keyup', onChange)
		btnTcvr.addEventListener('click', onClick)
	</script>
</body>
</html>
